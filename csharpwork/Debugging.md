
---


## Decompiling assemblies

https://github.com/markjprice/cs13net9/blob/main/docs/ch07-decompiling.md

## üîç What Are PDB Files?

**PDB** stands for **Program Database**.  
A PDB file is a _symbol_ file that stores **debugging information** about a compiled binary (EXE, DLL, etc.).

---

## What‚Äôs Inside a PDB?

- **Source file paths** (where your code came from)
- **Line numbers** (mapping between IL/native code and lines in your source)
- **Function names** (including inlined and optimized code)
- **Local variable names** and data types
- **Metadata for breakpoints, exceptions, stack traces, etc.**

---

## PDB Files in .NET

### How Are They Created?

- Generated during build (`dotnet build` or within Visual Studio) when compiling with debug information.
- Output location and format depend on your `.csproj` settings.

### Types of PDBs

- **Full/Portable PDBs:**  
  - *Portable PDB* (`.pdb`): Cross-platform, default for .NET Core and .NET 5+.
  - *Windows PDB* (`.pdb`): Windows-only, legacy for .NET Framework and earlier.
- You can control this:
  ```xml
  <DebugType>portable</DebugType>
  ```
  or
  ```xml
  <DebugType>full</DebugType>
  ```

### Why Are PDBs Important?

- **Enable debugging:** Set breakpoints in source code, step through code, inspect variables.
- **Enable rich stack traces:** See file/line numbers in exceptions.
- **Enable tools:** Profilers, performance analyzers, crash dump analysis.

### What Happens If You Don‚Äôt Have a PDB?

- Stack traces show only function names (maybe), no line numbers.
- Breakpoints may not map to source lines.
- Harder to diagnose crashes or bugs.

### How to Ship PDBs

- **Development:** Always generate and keep PDBs.
- **Production:**  
  - Can choose to deploy or not.
  - Deploying PDBs helps diagnose live issues (with tools like WinDbg, dotnet-dump, etc.).
  - Security: PDBs may reveal source layouts/names. Consider using **SourceLink** for secure symbol navigation without source leaks.

---

## PDB Files in C++ (Windows)

### How Are They Created?

- Generated by MSVC, clang, or other compilers/linkers when building with debug info (`/Zi`, `/Z7`, `/DEBUG` flags).

### Why Are PDBs Important?

- **Debugging (Visual Studio, WinDbg, etc.):** Same as .NET‚Äîenable breakpoints, variable inspection, step through code.
- **Crash Dump Analysis:** PDBs are *essential* for post-mortem debugging.
- **Symbol Servers:** Store and retrieve PDBs for deployed builds (e.g., using Microsoft Symbol Server).

### What Happens If You Don‚Äôt Have a PDB?

- No line numbers or variable names in stack traces.
- Disassembly-only debugging.
- Hard to analyze crash dumps.

---

## Debugging Techniques

### .NET Debugging

- **Visual Studio:**  
  - F5 to debug, breakpoints, variable watch, call stack, immediate window, edit-and-continue.
- **Visual Studio Code:**  
  - With C#/OmniSharp extensions.
- **dotnet CLI:**  
  - `dotnet build --configuration Debug`
  - `dotnet publish --configuration Release /p:DebugType=portable /p:DebugSymbols=true`
- **Crash Dump Analysis:**  
  - Tools: `dotnet-dump`, WinDbg, Visual Studio
  - Stack traces with PDBs.
- **Remote Debugging:**  
  - Debug apps running on a remote machine or Docker container.
- **SourceLink:**  
  - Embeds source control information in the PDB for seamless debugging even if you don‚Äôt have the source locally.

### C++ Debugging (Windows)

- **Visual Studio:**  
  - Native debugging with breakpoints, step-through, variable and memory inspection.
  - Can load symbols from symbol servers.
- **WinDbg:**  
  - Advanced kernel/user-mode debugging.
  - Symbol paths: `_NT_SYMBOL_PATH` environment variable.
- **Crash Dump Analysis:**  
  - Analyze `.dmp` files post-crash, needs matching PDB.
- **Remote Debugging:**  
  - Debug over network.
- **Mixed-Mode Debugging:**  
  - Debug both managed (.NET) and native (C++) together.

---

## Symbol Servers and SourceLink

- **Symbol Servers:**  
  - Centralized storage for PDBs.
  - Configure Visual Studio to fetch symbols from corporate or Microsoft servers.
  - Great for shared builds, CI/CD, and deployed app support.
- **SourceLink (.NET):**  
  - Embeds source repo info in PDBs.
  - Seamless "step into" code even if you only have the PDB and source repo.

---

## Best Practices

- **Always generate and archive PDBs** for every release/build (keep them safe for post-mortem debugging).
- **Don‚Äôt ship PDBs with release binaries** unless you need to debug in production (security risk).
- **Use SourceLink** to connect PDBs with source code repositories.
- **Configure symbol servers** if you‚Äôre building for a team or distributing commercial software.

---

## Quick Reference Table

| Platform  | PDB Type         | Debugging Tool Examples | Symbol Server Support | Source Mapping |
|-----------|------------------|------------------------|----------------------|---------------|
| .NET      | Portable, Full   | VS, VSCode, dotnet-dump| Yes                  | Yes (SourceLink) |
| C++/Win   | Windows PDB      | VS, WinDbg, gflags     | Yes                  | No (source path only) |

---

## Debugging Without PDBs

- **You can only see function names and addresses.**
- **You cannot step through code or set line-based breakpoints.**
- **Crash dumps become much less useful.**

---

## Summary

- **PDB files are critical for effective debugging** on both .NET and C++/Windows.
- They **map your binaries back to your source code** for tools and humans.
- Always **archive PDBs for every build** you release.
- Use **SourceLink** and/or **symbol servers** for professional development and support.
- Debugging without PDBs is possible but much, much harder.

---

